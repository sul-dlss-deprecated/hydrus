<%- @page_title = "Editing '#{@document_fedora.title.first}' - #{application_name}" -%>
<%- object_type = @document_fedora.object_type -%>
<% sidebar_items << capture do %>
  <div class="well actions-box" id="item-actions">
    <fieldset>
      <legend class="box-header">Actions</legend>
      <button type="submit" class="btn btn-small save-edits" name="save" id="save">Save</button>
      <label class="checkbox">
        <input type="checkbox" name="terms" id="terms" /> I agree to the <a href="#">terms of deposit</a> for the Stanford Digital Repository
      </label>
      <button type="submit" class="btn btn-small" id="publish" name="publish" disabled="disabled">Publish</button>
      <p class="discard-item"><i class="icon-trash"></i> <a href="#">Discard this <%= object_type %></a></p>
    </fieldset>
  </div>
<%- end -%>


<div class="row">
  <div class="span9">
		<%=render :partial=>'shared/navigation' %>
  </div>
</div>
<%= form_for(@document_fedora, :method => 'PUT', :html => {:class=>"step", :multipart=>true}) do |f| -%>
  <%= hidden_field_tag("object_id", params[:id]) -%>
  <%= hydrus_form_header(:required=>true, :first=>true) {"Title"} %>
  <div class="row">
    <%= hydrus_form_label do %>
      <%= f.label :"title[0]", "Title of #{object_type}" %>
    <%- end -%>
    <%= hydrus_form_value(:class=>"short-textarea") do %>
      <%= f.text_area :"title[0]", :value=>@document_fedora.title.first, :required=>true %>
    <%- end -%>
  </div>
  <div class="row">
    <%= hydrus_form_label do %>
      Contact email
    <%- end -%>
    <%= hydrus_form_value(:class=>"short-textarea") do %>
      #TODO: spec is unclear
    <%- end -%>
  </div>

  <%= hydrus_form_header(:required=>true) {"People and organizations responsible for this #{object_type}"} -%>
  <div class="row">
    <%= hydrus_form_label do %>
      <%= label_tag("asset_descMetadata_name_namePart_0", "People") -%>
    <%- end -%>
    <%= hydrus_form_value(:class=>"people-select destroy-group") do -%>
      <%= render "people" %>
    <%- end -%>
  </div>

  <%= hydrus_form_header(:required=>true) {"Upload file(s)"} -%>
  <div class="row">
    <div class="span9" id="file-upload">
      <div id="uploaded-files">
        <%- unless @document_fedora.files.blank? -%>
          <%- @document_fedora.files.each do |file| -%>
            <%= render :partial => "object_files/object_file", :locals => {:file => file} %>
          <%- end -%>
        <%- end -%>
      </div>
      <div class="row">
        <div class="span7 offset2">
          <%= file_field_tag "files[]", :multiple=>true %>
        </div>    
      </div>
    </div>
  </div>

  <%= hydrus_form_header(:required=>true) {"Abstract and keywords"} -%>
  <div class="row">
    <%= hydrus_form_label do %>
      <%= f.label :abstract %>
    <%- end -%>
    <%= hydrus_form_value do  -%>
      <%= f.text_area :abstract, :value=>@document_fedora.abstract.first, :require=>true %>
    <%- end -%>
  </div>
  <div class="row">
    <%= hydrus_form_label do %>
      <%= label_tag("hydrus_item_keywords", "Keywords") %>
    <%- end -%>
    <%= hydrus_form_value do  -%>
      <%= text_field_tag("hydrus_item_keywords", @document_fedora.descMetadata.subject.topic.join(", ")) -%>
      <div class="help">separate keywords with commas</div>
    <%- end -%>    
  </div>

  <%= hydrus_form_header {"Citation"} -%>
  <div class="row">
    <%= hydrus_form_label do %>
      <%= f.label :preferred_citation, "Cite this #{object_type} as" %>
    <%- end -%>
    <%= hydrus_form_value(:class=>"short-textarea") do  -%>
      <%= f.text_area :preferred_citation, :value=>@document_fedora.preferred_citation.first %>
    <%- end -%>
  </div>

  <%= hydrus_form_header {"Links to related content"} -%>
  <div id="related-items" class="destroy-group">
    <%= render "related_items" %>
  </div>
  <div class="row">
    <div class="span7 offset2">
      <%= button_tag("Add another link", :name=>"add_link", :"data-attribute" => "add_link", :id=>"add_link", :class=>"btn", :value=>@document_fedora.related_items.length) %>
    </div>
  </div>
  <noscript>
    <button type="submit" class="btn btn-small save-edits" name="save" id="save">Save</button>    
    <button type="submit" class="btn btn-small" id="publish" name="publish" disabled="disabled">Publish</button>
  </noscript>
<%- end -%>

<% render(
     :partial => "hydra/permissions/index", 
     :locals  => { :document => @document_fedora, :asset_id => params[:id] }
   )
%>

